# üß™ AGENT TESTING FRAMEWORK - COMPLETE GUIDE

## üìã **Overview**

This testing framework provides everything you need to validate agent accuracy, performance, and reliability before beta launch.

---

## üèóÔ∏è **Architecture**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  TESTING FRAMEWORK                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  1. TEST INFRASTRUCTURE (Vitest)                                ‚îÇ
‚îÇ     ‚îú‚îÄ vitest.config.ts                                         ‚îÇ
‚îÇ     ‚îú‚îÄ tests/setup.ts                                           ‚îÇ
‚îÇ     ‚îî‚îÄ Test runners & utilities                                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  2. TEST DATASETS (JSON scenarios)                              ‚îÇ
‚îÇ     ‚îú‚îÄ productivity-agent-scenarios.json (100 scenarios)        ‚îÇ
‚îÇ     ‚îú‚îÄ sales-copilot-scenarios.json (100 scenarios)             ‚îÇ
‚îÇ     ‚îú‚îÄ travel-agent-scenarios.json (100 scenarios)              ‚îÇ
‚îÇ     ‚îî‚îÄ banking-teller-scenarios.json (100 scenarios)            ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  3. UNIT TESTS (Fast, isolated)                                 ‚îÇ
‚îÇ     ‚îî‚îÄ tests/unit/agents/*.test.ts                              ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  4. ACCURACY MEASUREMENT                                         ‚îÇ
‚îÇ     ‚îî‚îÄ tests/accuracy/AgentAccuracyTester.ts                    ‚îÇ
‚îÇ         ‚îú‚îÄ Runs all scenarios                                   ‚îÇ
‚îÇ         ‚îú‚îÄ Measures pass/fail                                   ‚îÇ
‚îÇ         ‚îú‚îÄ Generates reports                                    ‚îÇ
‚îÇ         ‚îî‚îÄ Identifies patterns                                  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  5. MONITORING & OBSERVABILITY                                   ‚îÇ
‚îÇ     ‚îî‚îÄ src/services/monitoring/AgentMonitor.ts                  ‚îÇ
‚îÇ         ‚îú‚îÄ Tracks all agent actions                             ‚îÇ
‚îÇ         ‚îú‚îÄ Measures performance                                 ‚îÇ
‚îÇ         ‚îú‚îÄ Detects anomalies                                    ‚îÇ
‚îÇ         ‚îî‚îÄ Exports metrics                                      ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  6. SAFETY RAILS                                                 ‚îÇ
‚îÇ     ‚îî‚îÄ src/components/agent/SafetyRails.tsx                     ‚îÇ
‚îÇ         ‚îú‚îÄ Confirmation dialogs                                 ‚îÇ
‚îÇ         ‚îú‚îÄ Risk assessment                                      ‚îÇ
‚îÇ         ‚îú‚îÄ 2FA for critical actions                             ‚îÇ
‚îÇ         ‚îî‚îÄ Reversibility checks                                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  7. TESTING DASHBOARD                                            ‚îÇ
‚îÇ     ‚îî‚îÄ src/pages/AgentTestingDashboard.tsx                      ‚îÇ
‚îÇ         ‚îú‚îÄ Real-time performance                                ‚îÇ
‚îÇ         ‚îú‚îÄ Success rates                                        ‚îÇ
‚îÇ         ‚îú‚îÄ Error tracking                                       ‚îÇ
‚îÇ         ‚îî‚îÄ Health status                                        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ **Quick Start**

### **Step 1: Install Dependencies**

```bash
npm install --save-dev vitest @vitest/ui vitest-coverage-v8
```

### **Step 2: Run Unit Tests**

```bash
npm run test
```

### **Step 3: Run Accuracy Tests**

```bash
# Test Productivity AI Agent
npx ts-node tests/accuracy/AgentAccuracyTester.ts productivity

# Test Sales Copilot
npx ts-node tests/accuracy/AgentAccuracyTester.ts sales

# Test all agents
npm run test:accuracy
```

### **Step 4: View Testing Dashboard**

```bash
npm run dev
# Navigate to /testing-dashboard
```

---

## üìä **Test Datasets**

### **Productivity AI Agent (100 scenarios)**

| Category | Count | Examples |
|----------|-------|----------|
| Email Classification | 20 | Urgent, Spam, Newsletter, Meeting Request |
| Task Extraction | 20 | Multi-task emails, Deadlines, Ambiguous |
| Auto-Response | 15 | Invoices, Routine queries, Executive emails |
| Meeting Scheduling | 15 | Calendar conflicts, Multi-participant |
| Context Understanding | 20 | Thread continuity, References |
| Daily Summary | 10 | Mixed email types, Prioritization |

**Sample Scenario:**

```json
{
  "id": "prod-001",
  "category": "email_classification",
  "input": {
    "email": {
      "from": "boss@company.com",
      "subject": "URGENT: Q4 Budget Approval Needed",
      "body": "Hi, I need you to approve the Q4 marketing budget by EOD today..."
    }
  },
  "expected_output": {
    "classification": "urgent",
    "priority": "high",
    "requires_action": true,
    "action_items": ["Review Q4 marketing budget", "Provide approval by EOD"]
  },
  "pass_criteria": {
    "must_classify_as": "urgent",
    "must_not_auto_respond": true,
    "confidence_threshold": 0.9
  }
}
```

---

## üéØ **How to Add New Test Scenarios**

1. **Choose a category** (e.g., "email_classification")
2. **Define input** (email, context, settings)
3. **Define expected output** (classification, action_items, response)
4. **Define pass criteria** (what makes this test pass?)

**Example:**

```json
{
  "id": "prod-XXX",
  "category": "new_category",
  "input": { /* your test input */ },
  "expected_output": { /* what should happen */ },
  "pass_criteria": { /* how to validate */ }
}
```

---

## üìà **Accuracy Measurement**

### **Run Accuracy Tests:**

```bash
cd tests/accuracy
npx ts-node AgentAccuracyTester.ts productivity
```

### **Output:**

```
üß™ Running 100 test scenarios...
‚úÖ prod-001: email_classification (1250ms)
‚úÖ prod-002: email_classification (980ms)
‚úÖ prod-003: task_extraction (1450ms)
‚ùå prod-004: auto_response (2100ms)
...

============================================================
üìä AGENT ACCURACY REPORT
============================================================
Agent Type: productivity
Test Date: 2025-01-22T...
Total Scenarios: 100
Passed: 87 (87.0%)
Failed: 13
Avg Duration: 1350ms

üìà Accuracy by Category:
  ‚úÖ email_classification: 19/20 (95.0%)
  ‚úÖ task_extraction: 18/20 (90.0%)
  ‚ö†Ô∏è  auto_response: 12/15 (80.0%)
  ‚úÖ meeting_scheduling: 14/15 (93.3%)
  ‚úÖ context_understanding: 17/20 (85.0%)
  ‚úÖ daily_summary: 7/10 (70.0%)

‚ùå Failed Scenarios:
  ‚Ä¢ prod-004: Failed criterion: confidence_threshold
  ‚Ä¢ prod-015: Failed criterion: must_extract_all_tasks
  ...
============================================================
```

### **Report Files:**

- `reports/accuracy-productivity-1705937000000.json`
- Includes detailed results for every scenario
- Can be analyzed programmatically

---

## üîç **Monitoring & Observability**

### **Track Agent Actions:**

```typescript
import { agentMonitor } from './services/monitoring/AgentMonitor';

// Track successful action
await agentMonitor.trackAction(
  agentId,
  'productivity',
  'process_email',
  {
    success: true,
    duration_ms: 1250,
    confidence: 0.95,
    metadata: { classification: 'urgent' }
  }
);

// Track failure
await agentMonitor.trackAction(
  agentId,
  'productivity',
  'auto_respond',
  {
    success: false,
    duration_ms: 2100,
    error: 'Confidence too low',
    metadata: { confidence: 0.65 }
  }
);
```

### **Get Performance Stats:**

```typescript
const stats = await agentMonitor.getPerformanceStats(agentId, 24); // Last 24 hours

console.log(`Success Rate: ${stats.success_rate}%`);
console.log(`Avg Duration: ${stats.avg_duration_ms}ms`);
console.log(`Total Actions: ${stats.total_actions}`);
```

### **Detect Anomalies:**

```typescript
const { hasAnomalies, issues } = await agentMonitor.detectAnomalies(agentId);

if (hasAnomalies) {
  console.log('üö® ALERT: Agent performance issues detected');
  issues.forEach(issue => console.log(`  ‚Ä¢ ${issue}`));
}
```

---

## üõ°Ô∏è **Safety Rails**

### **Usage:**

```typescript
import { useSafetyRails, SAFETY_RULES } from './components/agent/SafetyRails';

const { SafetyRailsComponent, requestConfirmation } = useSafetyRails();

// Before risky action
const confirmed = await requestConfirmation(SAFETY_RULES.block_bank_card);

if (confirmed) {
  // Proceed with action
  await agent.blockCard(cardId);
} else {
  // User cancelled
  console.log('Action cancelled by user');
}

// Render safety component
return <>{SafetyRailsComponent}</>;
```

### **Available Safety Rules:**

- `send_email_to_executive` - High risk
- `block_bank_card` - Critical risk (requires 2FA)
- `book_flight` - High risk (financial)
- `send_bulk_emails` - Medium risk
- `auto_respond_email` - Low risk

---

## üìä **Testing Dashboard**

Access at: `/testing-dashboard`

**Features:**
- Real-time agent performance
- Success rate tracking
- Response time monitoring
- Error detection
- Health status indicators

---

## ‚úÖ **Pre-Launch Checklist**

### **Week 1: Core Testing**
- [ ] Run all unit tests (`npm run test`)
- [ ] Run accuracy tests for all agents
- [ ] Fix failing scenarios (target: 90%+ accuracy)
- [ ] Measure performance (target: <5s per action)

### **Week 2: Safety & Monitoring**
- [ ] Add safety confirmations for all risky actions
- [ ] Set up monitoring for all agents
- [ ] Create anomaly detection alerts
- [ ] Test error handling (network failures, API timeouts)

### **Week 3: Beta Preparation**
- [ ] Create user documentation
- [ ] Set up feedback collection
- [ ] Prepare rollback procedures
- [ ] Train support team

---

## üéØ **Success Criteria**

| Metric | Target | Status |
|--------|--------|--------|
| **Accuracy Rate** | >90% | ‚è≥ Pending |
| **Success Rate** | >95% | ‚è≥ Pending |
| **Avg Response Time** | <5s | ‚è≥ Pending |
| **Timeout Rate** | <5% | ‚è≥ Pending |
| **User Satisfaction** | >4.5/5 | ‚è≥ Pending |

---

## üöÄ **Next Steps**

1. **Run the tests!**
   ```bash
   npm run test:accuracy
   ```

2. **Review the reports**
   - Check `reports/` directory
   - Identify failure patterns

3. **Fix issues**
   - Improve prompts
   - Add validation
   - Enhance context

4. **Repeat until 90%+ accuracy** ‚úÖ

---

## üìû **Support**

Need help? Check:
- Test scenarios: `tests/datasets/`
- Example tests: `tests/unit/agents/ProductivityAgent.test.ts`
- Monitoring code: `src/services/monitoring/AgentMonitor.ts`

**You're ready to build reliable, production-grade AI agents!** üéâ


